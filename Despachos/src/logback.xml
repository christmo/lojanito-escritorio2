<?xml version="1.0" encoding="UTF-8"?>

<configuration>
    <timestamp key="fecha" datePattern="yyyy-MM-dd"/>

    <jmxConfigurator contextName="KRADAC" />
    
    <!-- Se puede establecer el directorio "a mano" o usar el del usuario  -->
    <property file="${java.io.tmpdir}/configsystem.properties" />
    <property name="dir_proyecto" value="${dirProyecto}"/>
    <property name="appName" value="kradac" />
    <property name="logPath" value="${dir_proyecto}/KradacLogs" />

    <appender name="TRACE" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>TRACE</level>
        </filter>

        <File>${logPath}/${fecha}/${appName}.t.log</File>

        <!-- full stacktrace para las excepciones -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n[excepciones] %exception{full}%n{2}
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/${appName}.t.%d{yyyy-MM-dd}.log</FileNamePattern>
            <!-- mantener 5 días de historia -->
            <MaxHistory>5</MaxHistory>
        </rollingPolicy>
    </appender>

    <appender name="DEBUG" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>DEBUG</level>
        </filter>

        <File>${logPath}/${fecha}/${appName}.d.log</File>

        <!-- 10 líneas de stacktrace para las excepciones -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n 
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/${appName}.d.%d{yyyy-MM-dd}.log</FileNamePattern>
            <!-- mantener 10 días de historia -->
            <MaxHistory>10</MaxHistory>
        </rollingPolicy>
    </appender>

    <!--
    1 por día. Nivel INFO. 300 días de historia
    -->
    <appender name="INFO" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>INFO</level>
        </filter>
        <File>${logPath}/${fecha}/${appName}.log</File>

        <!-- 5 líneas de stacktrace para las excepciones -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/${appName}.%d{yyyy-MM-dd}.log</FileNamePattern>
            <!-- mantener 300 días de historia -->
            <MaxHistory>300</MaxHistory>
        </rollingPolicy>
    </appender>

    <!-- Trace para el guardado de informacion en el servidor de KRADAC-->
    <appender name="TRACE_GSK" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>TRACE</level>
        </filter>
        <File>${logPath}/${fecha}/GSK/${appName}.log</File>

        <!-- 5 líneas de stacktrace para las excepciones -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/GSK.%d{yyyy-MM-dd}.log</FileNamePattern>
            <!-- mantener 300 días de historia -->
            <MaxHistory>300</MaxHistory>
        </rollingPolicy>
    </appender>

    <!-- Trace para el actualizado de informacion en el servidor de KRADAC-->
    <appender name="TRACE_ASK" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>TRACE</level>
        </filter>
        <File>${logPath}/${fecha}/ASK/${appName}.log</File>

        <!-- 5 líneas de stacktrace para las excepciones -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/ASK.%d{yyyy-MM-dd}.log</FileNamePattern>
            <!-- mantener 300 días de historia -->
            <MaxHistory>300</MaxHistory>
        </rollingPolicy>
    </appender>

    <!--
    <appender name="ERROR" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>ERROR</level>
        </filter>
        <File>${logPath}/${fecha}/${appName}.log</File>

        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}] [%F] [%thread] [linea %L] [Metodo %M] %logger{36} - %msg%n[excepciones] %exception{full}%n
            </Pattern>
        </layout>

        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <FileNamePattern>${logPath}/%d{yyyy-MM-dd}/${appName}.e.%d{yyyy-MM-dd}.log</FileNamePattern>
            <MaxHistory>300</MaxHistory>
        </rollingPolicy>
    </appender>
    -->

    <appender name="pantalla" class="ch.qos.logback.core.ConsoleAppender">
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n{3}
            </Pattern>
        </layout>
    </appender>

    <!--
     Enviar mail cuando se produsca un error
    -->
    <appender name="EMAIL" class="ch.qos.logback.classic.net.SMTPAppender">
        <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
            <level>ERROR</level>
        </filter>
        <SMTPHost>smtp.gmail.com</SMTPHost>
        <SMTPPort>465</SMTPPort>
        <SSL>true</SSL>
        <Username>soporte@kradac.com</Username>
        <Password>superkradacalrescate</Password>

        <To>soporte@kradac.com</To>
        <From>soporte@kradac.com</From>
        <Subject>Logs: %logger{20} - %m</Subject>
        <layout class="ch.qos.logback.classic.PatternLayout">
            <Pattern>
                [%p][%d{dd/MM/yyyy HH:mm:ss}][%F][%thread][linea %L][Metodo %M] %logger{36} - %msg%n[excepciones] %exception{full}%n{2}
            </Pattern>
        </layout>
    </appender>

    <logger name="Pruebas" level="ALL">
        <appender-ref ref="INFO"/>
        <appender-ref ref="DEBUG"/>
        <appender-ref ref="TRACE"/>
        <appender-ref ref="pantalla"/>
    </logger>

    <logger name="BaseDatos.ConexionBase" level="TRACE">
        <appender-ref ref="TRACE"/>
        <appender-ref ref="EMAIL"/>
    </logger>

    <logger name="login" level="ALL">
        <appender-ref ref="DEBUG"/>
        <appender-ref ref="pantalla" />
    </logger>

    <logger name="interfaz.Principal" level="ALL">
        <appender-ref ref="EMAIL"/>
        <appender-ref ref="INFO"/>
        <appender-ref ref="DEBUG"/>
        <appender-ref ref="TRACE"/>
        <appender-ref ref="pantalla"/>
    </logger>

    <logger name="interfaz.comunicacion.servidorBD.GuardarServidorKRADAC" level="ALL">
        <appender-ref ref="TRACE_GSK"/>
        <appender-ref ref="DEBUG"/>
    </logger>

    <logger name="interfaz.comunicacion.servidorBD.ActualizarServidorKRADAC" level="ALL">
        <appender-ref ref="TRACE_ASK"/>
        <appender-ref ref="DEBUG"/>
    </logger>

</configuration>